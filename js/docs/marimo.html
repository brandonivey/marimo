<!DOCTYPE html>  <html> <head>   <title>marimo.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               marimo.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>marimo is a library for self-aware, self-updating, and self-rendering HTML widgets.</h1>

<p>it provides a variety of javascript objects that can ask for data and
intelligently render themselves. These widgets are intended to be extended
by application developers. Marimo is being developed at Cox Media Group
Digital for rendering advertisements, comment threads, and various
"real-time" widgets such as weather reports and radio "now playing"
displays  Our hope is to provide a generic framework to replace the many
one-off ajax->backend view hacks that tend to grow on modern web
applications.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>polyfill for Object.create, sadly</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Object.create implementation only accepts the first parameter.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">function</span> <span class="nx">F</span><span class="p">()</span> <span class="p">{}</span>
        <span class="nx">F</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">o</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">F</span><span class="p">();</span>
    <span class="p">};</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>namespace / object</h2>

<p>this namespace stores the general marimo state (widget requests, live
widgets, an event registry), acts as an event transport for widgets, and
houses "widgetlib," a collection of widgets that can either be used ori
differentially inherited from.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">marimo</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>batch request objects that widgets use to get fresh data about themselves</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">requests</span><span class="o">:</span> <span class="p">{},</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>live widgets on the page</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">widgets</span><span class="o">:</span> <span class="p">{},</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>an event registry for tracking events that have occurred</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">events</span><span class="o">:</span> <span class="p">{},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h3>init</h3>

<p>this is an idiom you will see throughout marimo. <code>init</code> is kind of like
a constructor, but don't think about it that way. it is used to set up
some kind of runtime state for an object. in this case, it's used to set
a js lib object (probably jQuery, but also possibly Ender or xuijs)</p>

<h4>note</h4>

<p>currently $ is assumed to have the following interface:
$(), $.ajax(settings), $().bind(), $().trigger(), $(function() {}).
this is obviously just jquery.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">init</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span> <span class="o">=</span> <span class="nx">$</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><strong>TODO</strong> write an adaptor that maps from {jquery,xuijs,etc} to a generic $ object</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>given data about a widget that should exist, create it and add it to
<code>this.widgets</code></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">add_widget</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">add_widget</span><span class="p">(</span><span class="nx">widget_args</span><span class="p">)</span> <span class="p">{</span>
       <span class="kd">var</span> <span class="nx">widget_prototype</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">[</span><span class="nx">widget_args</span><span class="p">[</span><span class="s1">&#39;widget_prototype&#39;</span><span class="p">]];</span>
       <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">widget_prototype</span><span class="p">)</span> <span class="p">{</span>
           <span class="nx">widget_prototype</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">base_widget</span><span class="p">;</span>
       <span class="p">}</span>
       <span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">widget_prototype</span><span class="p">);</span>
       <span class="k">this</span><span class="p">.</span><span class="nx">widgets</span><span class="p">[</span><span class="nx">widget_args</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span>
       <span class="k">this</span><span class="p">.</span><span class="nx">widgets</span><span class="p">[</span><span class="nx">widget_args</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">init</span><span class="p">(</span><span class="nx">widget_args</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>a simple wrapper around <code>this.add_widget()</code></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">add_widgets</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">add_widgets</span><span class="p">(</span><span class="nx">widgets</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">widgets</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">)){</span><span class="k">return</span><span class="p">;}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">add_widget</span><span class="p">(</span><span class="nx">widgets</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h3>make_request</h3>

<p>this is a bulk method for having all curent batch requests
(in <code>this.requests</code>) make their AJAX calls. It sets up
<code>this.handle_response()</code> to deal with the returned JSON.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">make_request</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">make_request</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">requests</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">requests</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
            <span class="kd">var</span> <span class="nx">batch</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">requests</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
            <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="nx">batch</span><span class="p">.</span><span class="nx">make_request</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="nx">that</span><span class="p">.</span><span class="nx">handle_response</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>dole out new widget data to widgets. uses <code>widget.id</code> to find and
deliver data.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">handle_response</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">handle_response</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">requests</span><span class="p">[</span><span class="nx">url</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">datum</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">datum</span><span class="p">))</span> <span class="p">{</span><span class="k">return</span><span class="p">}</span>
            <span class="kd">var</span> <span class="nx">widget_data</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">datum</span><span class="p">];</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">widgets</span><span class="p">[</span><span class="nx">widget_data</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">update</span><span class="p">(</span><span class="nx">widget_data</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">emit</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">emit</span><span class="p">(</span><span class="nx">evnt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">evnt</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">evnt</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h2>batch_request</h2>

<p>this object represents a single URL from which some number of widgets will
request templates and template context. It is here to synchronize and bulk
multiple requests to the same endpoint.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">marimo</span><span class="p">.</span><span class="nx">batch_request</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">init</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">payloads</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">add</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p><strong>TODO</strong> make more resilient/less trusting in the face of corrupted ids etc</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">payloads</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">make_request</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">make_request</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
       <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p><strong>TODO</strong> retries? better error callback?</p>             </td>             <td class="code">               <div class="highlight"><pre>       <span class="nx">marimo</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
         <span class="nx">url</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
         <span class="nx">data</span><span class="o">:</span> <span class="p">{</span><span class="nx">bulk</span><span class="o">:</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">payloads</span><span class="p">)},</span>
         <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span>
         <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span> <span class="p">},</span>
         <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
           <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;error processing bulk request &#39;</span><span class="o">+</span><span class="nx">that</span><span class="p">.</span><span class="nx">url</span><span class="o">+</span><span class="s1">&#39; with json &#39;</span><span class="o">+</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">payloads</span><span class="p">));</span>
         <span class="p">}</span>
       <span class="p">});</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h2>the widgetlib</h2>

<p>widgetlib holds raw objects that can be used with Object.create().</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h3>base_widget</h3>

<p>this is a base widget that knows nothing about requests. you probably should
only be inheriting from it.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">base_widget</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>no-op</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>no-op</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>set up an event listener. such events will be later emitted by marimo.
check to see if designated event has already been emitted so we can fire
synchronously.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">on</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evnt</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">marimo</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">evnt</span><span class="p">])</span> <span class="p">{</span>
             <span class="nx">cb</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
             <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">marimo</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="nx">evnt</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">cb</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="p">})</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h3>request_widget</h3>

<p>this is a requestful widget that uses network calls to get templates/info to
render. it funnels requests through batch_request objects.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">request_widget</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">base_widget</span><span class="p">);</span>
<span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">request_widget</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">murl</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">murl</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">add_request</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>this is a separate method so it can be called repeatedly. we're not doing
that yet.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">request_widget</span><span class="p">.</span><span class="nx">add_request</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">add_request</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">marimo</span><span class="p">.</span><span class="nx">requests</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">murl</span><span class="p">])</span> <span class="p">{</span>
        <span class="nx">marimo</span><span class="p">.</span><span class="nx">requests</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">murl</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">marimo</span><span class="p">.</span><span class="nx">batch_request</span><span class="p">).</span><span class="nx">init</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">murl</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">marimo</span><span class="p">.</span><span class="nx">requests</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">murl</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">request_widget</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>merge data with this's</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>this will do more interesting things in the future.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
<span class="p">};</span>
<span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">request_widget</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p><strong>TODO</strong> support a template_url (distinct from data api)
<strong>TODO</strong> make not-mustache-specific</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">template</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">context</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">marimo</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Actually modify the DOM. note that this is the only time we care about onready.
<strong>TODO</strong> could instead use this.id+'<em>ready' event like writecapture</em>widget</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">marimo</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="nx">that</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h3>writecapture_widget</h3>

<p>a widget for handling html with potentially horrible javascript. note
that this is not requestful.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">writecapture_widget</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">base_widget</span><span class="p">);</span>
<span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">writecapture_widget</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">init</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p><strong>TODO</strong> should this hard-inherit from base_widget here? prob not?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">base_widget</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">that</span><span class="p">.</span><span class="nx">render</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">that</span><span class="p">)</span> <span class="p">},</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">writecapture_widget</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="s1">&#39;_ready&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">marimo</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="nx">that</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">writeCapture</span><span class="p">().</span><span class="nx">html</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">html</span><span class="p">));</span>
    <span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>yeah this hurts. this is for html that is in JSON that is staticly put on
pages (like, oh, say, for ads). browsers will pick up on the </script> and
blow up.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">writecapture_widget</span><span class="p">.</span><span class="nx">decode</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">decode</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\$ENDSCRIPT/g</span><span class="p">,</span> <span class="s2">&quot;&lt;/script&gt;&quot;</span><span class="p">);</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <h3>onready_widget</h3>

<p>a writecapture widget that waits for doc.ready to render</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">onready_widget</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">writecapture_widget</span><span class="p">);</span>
<span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">onready_widget</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">marimo</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">marimo</span><span class="p">.</span><span class="nx">widgetlib</span><span class="p">.</span><span class="nx">writecapture_widget</span><span class="p">.</span><span class="nx">render</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">that</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p><strong>TODO</strong> websocket widget
<strong>TODO</strong> don't assume jquery
<strong>TODO</strong> don't assume JSON
<strong>TODO</strong> roll writecapture and mustache into our generalized $
<strong>TODO</strong> fix indentation</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 